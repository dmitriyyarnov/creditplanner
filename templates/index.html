<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Credit Planner</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Credit Planner ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤</h1>

    <form action="/add" method="post" class="credit-form">
        <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞" required>
        <input type="number" step="0.01" name="amount" placeholder="–°—É–º–º–∞" required>
        <input type="date" name="due_date" required>
        <input type="text" name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞">
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <form method="get" action="/" class="filter-form">
        <label>–ú–µ—Å—è—Ü:
            <input type="month" name="month" value="{{ month }}">
        </label>
        <button type="submit">–§–∏–ª—å—Ç—Ä</button>
        <a href="/export/csv" class="btn-export">üìÑ CSV</a>
        <a href="/export/xlsx" class="btn-export">üìä Excel</a>
    </form>

    <h2>–°–ø–∏—Å–æ–∫ –∫—Ä–µ–¥–∏—Ç–æ–≤ –∑–∞ {{ month }}</h2>
    <table>
        <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–°—É–º–º–∞</th>
            <th>–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
            <th></th>
        </tr>
        {% for id, name, amount, due_date, comment in credits %}
        <tr>
            <td>{{ name }}</td>
            <td>{{ "%.2f"|format(amount) }} ‚ÇΩ</td>
            <td>{{ due_date }}</td>
            <td>{{ comment }}</td>
            <td>
                <form action="/delete/{{ id }}" method="post" style="display:inline;">
                    <button type="submit" class="delete">üóë</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <div class="summary">
        <strong>–ò—Ç–æ–≥–æ –∑–∞ {{ month }}: {{ "%.2f"|format(total_month) }} ‚ÇΩ</strong>
    </div>

    <h2>–ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
    <canvas id="chart"></canvas>

    <script>
        const data = {{ monthly_totals | tojson }};
        const ctx = document.getElementById('chart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    label: '–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤, ‚ÇΩ',
                    data: Object.values(data),
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    </script>
</body>
</html>

















